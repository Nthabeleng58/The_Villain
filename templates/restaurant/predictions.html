{% extends "base.html" %}

{% block title %}AI Predictions - The Villain Food-App{% endblock %}

{% block content %}
<div class="predictions-page" style="max-width: 1200px; margin: 0 auto;">
    <div class="page-header" style="margin-bottom: 2rem;">
        <h1 style="color: var(--text-light); margin-bottom: 0.5rem;">AI Sales Predictions</h1>
        <p style="color: var(--text-gray);">Machine learning forecast for {{ restaurant.name if restaurant else 'your restaurant' }}</p>
    </div>

    {% if not restaurant %}
    <div style="background: var(--card-bg); padding: 3rem; border-radius: var(--border-radius); text-align: center;">
        <i class="fas fa-store-slash" style="font-size: 4rem; color: var(--text-gray); margin-bottom: 1rem;"></i>
        <h3 style="color: var(--text-light); margin-bottom: 1rem;">No Restaurant Found</h3>
        <p style="color: var(--text-gray);">Register a restaurant to unlock AI forecasts.</p>
    </div>
    {% else %}
    <section class="prediction-metrics" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:1.5rem; margin-bottom:2rem;">
        <div class="metric-card" style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius); text-align:center;">
            <p style="color:var(--text-gray); margin-bottom:0.25rem;">7-day Revenue</p>
            <h2 style="color:var(--text-light); margin:0;">M{{ '%.2f'|format(weekly_total) }}</h2>
        </div>
        <div class="metric-card" style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius); text-align:center;">
            <p style="color:var(--text-gray); margin-bottom:0.25rem;">Daily Average</p>
            <h2 style="color:var(--text-light); margin:0;">M{{ '%.2f'|format(daily_avg) }}</h2>
        </div>
        <div class="metric-card" style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius); text-align:center;">
            <p style="color:var(--text-gray); margin-bottom:0.25rem;">Forecast Days</p>
            <h2 style="color:var(--text-light); margin:0;">{{ predictions|length }}</h2>
        </div>
        <div class="metric-card" style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius); text-align:center;">
            <p style="color:var(--text-gray); margin-bottom:0.25rem;">AI Status</p>
            <h2 style="color:#4CAF50; margin:0;">Active</h2>
        </div>
    </section>

    <section style="display:grid; grid-template-columns:2fr 1fr; gap:2rem;">
        <div style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h3 style="color:var(--text-light); margin:0;">Daily Forecast</h3>
                <button class="btn-primary" onclick="refreshPredictions()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            {% if predictions %}
                {% for prediction in predictions %}
                <div style="display:flex; justify-content:space-between; align-items:center; padding:0.75rem 0; border-bottom:1px solid #333;">
                    <div>
                        <p style="color:var(--text-light); margin:0;">{{ prediction.day_name }}</p>
                        <small style="color:var(--text-gray);">{{ prediction.date }}</small>
                    </div>
                    <div style="text-align:right;">
                        <p style="color:var(--primary-purple); font-weight:600; margin:0;">M{{ '%.2f'|format(prediction.predicted_sales) }}</p>
                        <small style="color:var(--text-gray);">Restaurant #{{ prediction.restaurant_id }}</small>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <p style="color:var(--text-gray);">No predictions available yet.</p>
            {% endif %}
        </div>

        <div>
            <div style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius); margin-bottom:1.5rem;">
                <h3 style="color:var(--text-light); margin-bottom:1rem;">AI Recommendations</h3>
                {% for item in popular_items %}
                <div style="padding:0.75rem; border:1px solid #444; border-radius:8px; margin-bottom:0.75rem;">
                    <p style="color:var(--text-light); margin:0 0 0.25rem 0;">{{ item.name }}</p>
                    <small style="color:var(--text-gray); display:block;">{{ item.category }}</small>
                    <small style="color:#4CAF50;">Ordered {{ item.order_count }} times</small>
                </div>
                {% else %}
                <p style="color:var(--text-gray);">Need more delivered orders for insights.</p>
                {% endfor %}
            </div>
            <div style="background: var(--card-bg); padding:1.5rem; border-radius:var(--border-radius);">
                <h3 style="color:var(--text-light); margin-bottom:1rem;">Next Actions</h3>
                <ul style="color:var(--text-gray); line-height:1.8; padding-left:1.2rem;">
                    <li>Adjust staffing to cover high revenue days.</li>
                    <li>Stock inventory for top recommended dishes.</li>
                    <li>Use `/ai/api/sales-predictions/{{ restaurant_id }}` for automation.</li>
                </ul>
            </div>
        </div>
    </section>
    {% endif %}
</div>

{% block scripts %}
<script>
    function refreshPredictions() {
        showNotification('Refreshing AI predictions...', 'info');
        fetch('{{ url_for("ai.api_sales_predictions", restaurant_id=restaurant_id) }}')
            .then(response => response.json())
            .then(() => window.location.reload())
            .catch(() => showNotification('Unable to refresh forecasts', 'error'));
    }
</script>
{% endblock %}
{% endblock %}

